---
apiVersion: helm.toolkit.fluxcd.io/v2beta2
kind: HelmRelease
metadata:
  name: nextcloud
spec:
  values:
    nextcloud:
      extraInitContainers:
        - name: init-db
          image: ghcr.io/onedr0p/postgres-init:14.8
          env:
            - name: INIT_POSTGRES_HOST
              value: postgres-rw.default.svc.cluster.local
            - name: INIT_POSTGRES_SUPER_USER
              valueFrom:
                secretKeyRef:
                  name: postgres-secret
                  key: username
            - name: INIT_POSTGRES_SUPER_PASS
              valueFrom:
                secretKeyRef:
                  name: postgres-secret
                  key: password
            - name: INIT_POSTGRES_USER
              valueFrom:
                secretKeyRef:
                  name: nextcloud-credentials
                  key: POSTGRES_USERNAME
            - name: INIT_POSTGRES_PASS
              valueFrom:
                secretKeyRef:
                  name: nextcloud-credentials
                  key: POSTGRES_PASSWORD
            - name: INIT_POSTGRES_DBNAME
              value: nextcloud
