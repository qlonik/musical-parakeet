---
apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
  name: nextcloud
spec:
  values:
    nextcloud:
      extraInitContainers:
        - name: minio-init-bucket
          image: ghcr.io/qlonik/minio-init-bucket:RELEASE.2024-06-01T15-03-35Z@sha256:af0f5d613d2c13a963066f56d7f3b5db9a2bb01aabd20210d699c5f2d45b2b25
          env:
            MINIO_HOST: http://minio.default.svc.cluster.local:9000
            MINIO_SUPER_ACCESS_KEY:
              valueFrom:
                secretKeyRef:
                  name: minio-secret
                  key: MINIO_ROOT_USER
            MINIO_SUPER_SECRET_KEY:
              valueFrom:
                secretKeyRef:
                  name: minio-secret
                  key: MINIO_ROOT_PASSWORD
            MINIO_BUCKET_NAME:
              valueFrom:
                secretKeyRef:
                  name: "{{ .Release.Name }}-restic-secret"
                  key: AWS_ACCESS_KEY_ID
            MINIO_BUCKET_PASSWORD:
              valueFrom:
                secretKeyRef:
                  name: "{{ .Release.Name }}-restic-secret"
                  key: AWS_SECRET_ACCESS_KEY
